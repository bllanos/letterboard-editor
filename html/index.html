<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Letterboard text validator</title>

  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
</head>

<body>

  <h2>Letterboard message text validator</h2>
  <p>
    Enter the text that you wish to display on the letterboard into the fields below.
    The webpage will enforce length limits on each line, and will ensure that the text respects the inventory of
    character cards.
  </p>
  <p>
    The webpage cannot guarantee that the text will fit on the letterboard, as it does not (yet) account for variations
    in card widths.
  </p>

  <!-- React component root. See https://reactjs.org/docs/add-react-to-a-website.html -->
  <div id="app_container"></div>

  <!-- Load the React portion of the page. -->
  <!-- For better performance, we would use Babel to process the script at build time. -->
  <!-- It would be nice to put the script in a separate file, but doing so is no longer possible because of changes to local file security policies (https://www.mozilla.org/en-US/security/advisories/mfsa2019-21/#CVE-2019-11730) -->
  <script type="text/babel">
    'use strict';

    /**
     * The number of sides of the sign
     */
    const N_SIDES = 2;

    /**
     * The number of lines per side
     */
    const N_LINESPERSIDE = 4;

    /**
     * The number of characters that can fit on a line
     */
    const MAX_CHARACTERSPERLINE = 20;

    /**
     * A mapping from characters to cards that can represent
     * more than one kind of character.
     */
    const CHARACTERS_TO_CARDS = {
      "0": "Oor0",
      "O": "Oor0",
      "6": "6or9",
      "9": "6or9"
    }

    /**
     * Inventory of character cards
     */
    const CARDS_TO_COUNTS = {
      "A": 18,
      "B": 10,
      "C": 10,
      "D": 10,
      "E": 24,
      "F": 10,
      "G": 16,
      "H": 10,
      "I": 14,
      "J": 8,
      "K": 10,
      "L": 10,
      "M": 16,
      "N": 10,
      "Oor0": 26,
      "P": 10,
      "Q": 6,
      "R": 16,
      "S": 18,
      "T": 18,
      "U": 10,
      "V": 8,
      "W": 10,
      "X": 8,
      "Y": 10,
      "Z": 6,
      "1": 8,
      "2": 8,
      "3": 8,
      "4": 8,
      "5": 8,
      "6or9": 16,
      "7": 8,
      "8": 8,
      "$": 8,
      "&": 8,
      "-": 8,
      "Â¢": 8,
      "@": 8,
      "%": 8,
      ":": 8,
      ".": 8
    }

    /**
     * The top-level container for the app
     */
    const App = () => {
      return (
        <React.Fragment>
          <MessageCompositor nSides={N_SIDES} nLinesPerSide={N_LINESPERSIDE} />
          <InventoryView />
          <MessagePrinter />
        </React.Fragment>
      );
    }

    /**
     * The interface for entering a trial message
     */
    const MessageCompositor = (props) => {
      let sides = [];
      for (let i = 0; i < props.nSides; ++i) {
        sides[i] = (<SignSide id={i} key={i.toString()} nLinesPerSide={props.nLinesPerSide} />);
      }
      return (
        <React.Fragment>
          <h3>Compose a message</h3>
          {sides}
        </React.Fragment>
      );
    }

    /**
     * The interface for entering text for the lines of a side of the sign
     */
    const SignSide = (props) => {
      const id = props.id;
      let lines = [];
      for (let i = 0; i < props.nLinesPerSide; ++i) {
        lines[i] = (<SignLine id={i} key={i.toString()} />);
      }
      return (
        <React.Fragment>
          <h4>Side {id + 1}: {props.nLinesPerSide} lines</h4>
          <ol>
            {lines}
          </ol>
        </React.Fragment>
      );
    }

    /**
     * The interface for entering text for one line of a side of the sign
     */
    const SignLine = (props) => {
      const id = props.id;
      const handleChange = (event) => {
        console.log("Text entered in line ", id, ": ", event.target.value);
      }
      return (
        <li>
          <input type="text" value={id} onChange={handleChange} />
          <ValidationMessage/>
        </li>
      );
    }

    /**
     * A message indicating a message validation check has detected a problem
     */
    const ValidationMessage = (props) => {
      if (props.text) {
        return (
          <p style={{ color: 'red' }}>{props.text}</p>
        );
      } else {
        return null;
      }
    }

    /**
     * A display of the available and remaining character cards
     */
    const InventoryView = (props) => {
      return (
        <h3>Inventory of character cards</h3>
      );
    }

    /**
     * A display of a valid message for the letterboard,
     * generated to allow for easy copy and paste into another application
     */
    const MessagePrinter = (props) => {
      let content = null;
      if (props.hasError) {
        content = (
          <ValidationMessage text={
            "Please address the validation error(s), after which this section will display"
          } />
        );
      } else {
        content = (
          <p>This is a copy of the text you entered above, that you can easily paste into another program (such as an email):</p>
        );
      }
      return (
        <React.Fragment>
          <h3>Full message text</h3>
          {content}
        </React.Fragment>
      );
    }

    const domContainer = document.querySelector('#app_container');
    ReactDOM.render(<App />, domContainer);
  </script>

</body>

</html>